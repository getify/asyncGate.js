/*! asyncGate.js
    v0.5 (c) Kyle Simpson
    MIT License: http://getify.mit-license.org
*/
(function(j){var q=j.$AG;function l(a){return Object.prototype.toString.call(a)=="[object Function]"}function r(a){return Object.prototype.toString.call(a)=="[object Array]"}function s(a){for(var b=0;b<a.length;){if(r(a[b])){a.splice.apply(a,[b,1].concat(a[b]));continue}b++}return a}function m(){var k;k=function(){function n(){for(var a=0;a<g.length;a++){if(!g[a])return false}return true}function o(){var a;if(h)return;if(d!==true&&d.length)d=[];g=[];if(f!==true&&f.length){while(a=f.shift()){if(c.length>0){a.apply({},c);c=[]}else a.call({})}f=true}}function t(){var a;if(h)return;f=true;g=[];if(d!==true&&d.length){while(a=d.shift()){if(c.length>0){a.apply({},c);c=[]}else a.call({})}d=true}}function p(){var a=g.length,b;g[a]=false;b=function(){if(!(i||h)){if(arguments.length>0)c.push([].slice.call(arguments));g[a]=true;if(n())o()}};b.fail=function(){if(!(i||h)){if(arguments.length>0)c.push([].slice.call(arguments));i=true;t()}};b.abort=function(){e.abort()}return b}var e,g=[],f=[],d=[],c=[],i=false,h=false;e={and:function(){if(i||h)return e;if(f===true){throw new Error("Wrong: gate has already been activated.");}var a,b;if(arguments.length==0)return p();a=s([].slice.call(arguments));for(b=0;b<a.length;b++){if(!l(a[b]))throw new Error("Wrong: non-function parameter passed in.");a[b](p())}return e},then:function(a){if(i||h)return e;if(!l(a))throw new Error("Wrong: non-function parameter passed in.");if(f!==true){f.push(a);if(n())o()}else{d=[];a.apply({},c);c=[]}return e},or:function(a){if(h)return e;if(!l(a))throw new Error("Wrong: non-function parameter passed in.");if(i||d===true){a.apply({},c);c=[]}else{d.push(a)}return e},abort:function(){h=true;g=f=d=messages=null}};if(arguments.length>0)e.and.apply({},arguments);return e};k.noConflict=function(){var a=j.$AG;j.$AG=q;return a};k.sandbox=function(){return m()};return k}j.$AG=m()})(this);