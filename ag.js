/*! asyncGate.js
    v0.5.1 (c) Kyle Simpson
    MIT License: http://getify.mit-license.org
*/
(function(j){var q=j.$AG;function l(a){return Object.prototype.toString.call(a)=="[object Function]"}function r(a){return Object.prototype.toString.call(a)=="[object Array]"}function s(a){for(var b=0;b<a.length;){if(r(a[b])){a.splice.apply(a,[b,1].concat(a[b]));continue}b++}return a}function m(){var k;k=function(){function n(){for(var a=0;a<g.length;a++){if(!g[a])return false}return true}function o(){var a;if(h)return;if(c!==true&&c.length)c=[];g=[];if(e!==true&&e.length){while(e&&(a=e.shift())){if(d.length>0){a.apply({},d);d=[]}else a.call({})}e=true}}function t(){var a;if(h)return;e=true;g=[];if(c!==true&&c.length){while(c&&(a=c.shift())){if(d.length>0){a.apply({},d);d=[]}else a.call({})}c=true}}function p(){var a=g.length,b;g[a]=false;b=function(){if(!(i||h)){if(arguments.length>0)d.push([].slice.call(arguments));g[a]=true;if(n())o()}};b.fail=function(){if(!(i||h)){if(arguments.length>0)d.push([].slice.call(arguments));i=true;t()}};b.abort=function(){f.abort()}return b}var f,g=[],e=[],c=[],d=[],i=false,h=false;f={and:function(){if(i||h)return f;if(e===true){throw new Error("Wrong: gate has already been activated.");}var a,b;if(arguments.length==0)return p();a=s([].slice.call(arguments));for(b=0;b<a.length;b++){if(!l(a[b]))throw new Error("Wrong: non-function parameter passed in.");a[b](p())}return f},then:function(a){if(i||h)return f;if(!l(a))throw new Error("Wrong: non-function parameter passed in.");if(e!==true){e.push(a);if(n())o()}else{c=[];a.apply({},d);d=[]}return f},or:function(a){if(h)return f;if(!l(a))throw new Error("Wrong: non-function parameter passed in.");if(i||c===true){a.apply({},d);d=[]}else{c.push(a)}return f},abort:function(){h=true;g=e=c=messages=null}};if(arguments.length>0)f.and.apply({},arguments);return f};k.noConflict=function(){var a=j.$AG;j.$AG=q;return a};k.sandbox=function(){return m()};return k}j.$AG=m()})(this);