/*! asyncGate.js
    v0.3 (c) Kyle Simpson
    MIT License: http://getify.mit-license.org
*/
(function(g){var n=g.$AG;function j(a){return Object.prototype.toString.call(a)=="[object Function]"}function o(a){return Object.prototype.toString.call(a)=="[object Array]"}function p(a){for(var b=0;b<a.length;){if(o(a[b])){a.splice.apply(a,[b,1].concat(a[b]));continue}b++}return a}function k(){var h;h=function(){var e,d=[],c=[];function l(){for(var a=0;a<d.length;a++){if(!d[a])return false}return true}function m(){var a;if(c!==true&&c.length){d=[];while(a=c.shift())a();c=true}}e={and:function(){function b(){var a=d.length;d[a]=false;return function(){d[a]=true;if(l())m()}}if(c===true||c.length>0){throw new Error("Can't call `and()` anymore.");}var i,f;if(arguments.length==0)return b();i=p([].slice.call(arguments));for(f=0;f<i.length;f++){if(!j(i[f]))throw new Error("Wrong: non-function parameter passed in.");i[f](b())}return e},then:function(a){if(!j(a))throw new Error("Wrong: non-function parameter passed in.");if(c!==true){c.push(a);if(l())m()}else a();return e}};if(arguments.length>0)e.and.apply({},arguments);return e};h.noConflict=function(){var a=g.$AG;g.$AG=n;return a};h.sandbox=function(){return k()};return h}g.$AG=k()})(this);