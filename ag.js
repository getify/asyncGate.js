/*! asyncGate.js
    v0.4 (c) Kyle Simpson
    MIT License: http://getify.mit-license.org
*/
(function(i){var p=i.$AG;function k(a){return Object.prototype.toString.call(a)=="[object Function]"}function q(a){return Object.prototype.toString.call(a)=="[object Array]"}function r(a){for(var b=0;b<a.length;){if(q(a[b])){a.splice.apply(a,[b,1].concat(a[b]));continue}b++}return a}function l(){var j;j=function(){var f,g=[],e=[],c=[],d=[],h=false;function m(){for(var a=0;a<g.length;a++){if(!g[a])return false}return true}function n(){var a;if(c!==true&&c.length)c=[];g=[];if(e!==true&&e.length){while(a=e.shift()){if(d.length>0){a.apply({},d);d=[]}else a.call({})}e=true}}function s(){var a;e=true;g=[];if(c!==true&&c.length){while(a=c.shift()){if(d.length>0){a.apply({},d);d=[]}else a.call({})}c=true}}function o(){var a=g.length,b;g[a]=false;b=function(){if(!h){if(arguments.length>0)d.push([].slice.call(arguments));g[a]=true;if(m())n()}};b.fail=function(){if(!h){if(arguments.length>0)d.push([].slice.call(arguments));h=true;s()}};return b}f={and:function(){if(e===true){throw new Error("Wrong: gate has already been activated.");}var a,b;if(arguments.length==0)return o();a=r([].slice.call(arguments));for(b=0;b<a.length;b++){if(!k(a[b]))throw new Error("Wrong: non-function parameter passed in.");a[b](o())}return f},then:function(a){if(h)return f;if(!k(a))throw new Error("Wrong: non-function parameter passed in.");if(e!==true){e.push(a);if(m())n()}else{c=[];a.call({})}return f},or:function(a){if(!k(a))throw new Error("Wrong: non-function parameter passed in.");if(h||c===true){a.apply({},d);d=[]}else{c.push(a)}return f}};if(arguments.length>0)f.and.apply({},arguments);return f};j.noConflict=function(){var a=i.$AG;i.$AG=p;return a};j.sandbox=function(){return l()};return j}i.$AG=l()})(this);