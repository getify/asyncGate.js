/*! asyncGate.js
    v0.1 (c) Kyle Simpson
    MIT License: http://getify.mit-license.org
*/
(function(f){var n=f.$AG;function i(a){return Object.prototype.toString.call(a)=="[object Function]"}function o(a){return Object.prototype.toString.call(a)=="[object Array]"}function p(a){for(var b=0;b<a.length;){if(o(a[b])){a.splice.apply(a,[b,1].concat(a[b]));continue}b++}return a}function j(){var g;g=function(){var e,c=[],d=[];function k(){if(c!==true){for(var a=0;a<c.length;a++){if(c[a]!==true)return false}c=true}return(c===true)}function l(){var a;if(d!==true&&d.length){while(a=d.shift())a();d=true}}e={and:function(){if(d===true||d.length>0){throw new Error("Can't call `and()` anymore.");return e}var m=p([].slice.call(arguments)),h;for(h=0;h<m.length;h++){(function(a,b){if(!i(a))throw new Error("Wrong: non-function parameter passed in.");c[b]=false;a(function(){c[b]=true;if(k())l()})})(m[h],c.length)}return e},then:function(a){if(!i(a))throw new Error("Wrong: non-function parameter passed in.");if(d!==true){d.push(a);if(k())l()}else a();return e}};e.and.apply({},arguments);return e};g.noConflict=function(){var a=f.$AG;f.$AG=n;return a};g.sandbox=function(){return j()};return g}f.$AG=j()})(this);