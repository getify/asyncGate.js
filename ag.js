/*! asyncGate.js
    v0.1 (c) Kyle Simpson
    MIT License: http://getify.mit-license.org
*/
(function(g){var o=g.$AG;function j(a){return Object.prototype.toString.call(a)=="[object Function]"}function p(a){return Object.prototype.toString.call(a)=="[object Array]"}function k(a){var b,e;for(b=0;b<a.length;b++){if(p(a[b])){e=k(a[b]);e.unshift(b,1);[].splice.apply(a,e);if(e.length==2)b--}}return a}function l(){var h;h=function(){var f,c=[],d=[];function m(){if(c!==true){for(var a=0;a<c.length;a++){if(c[a]!==true)return false}c=true}return(c===true)}function n(){var a;if(d!==true&&d.length){while(a=d.shift())a();d=true}}f={and:function(){if(d===true||d.length>0){throw new Error("Can't call `and()` anymore.");return f}var e=k([].slice.call(arguments)),i;for(i=0;i<e.length;i++){(function(a,b){if(!j(a))throw new Error("Wrong: non-function parameter passed in.");c[b]=false;a(function(){c[b]=true;if(m())n()})})(e[i],c.length)}return f},then:function(a){if(!j(a))throw new Error("Wrong: non-function parameter passed in.");if(d!==true){d.push(a);if(m())n()}else a();return f}};f.and.apply({},arguments);return f};h.noConflict=function(){var a=g.$AG;g.$AG=o;return a};h.sandbox=function(){return l()};return h}g.$AG=l()})(this);