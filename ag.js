/*! asyncGate.js
    v0.2 (c) Kyle Simpson
    MIT License: http://getify.mit-license.org
*/
(function(f){var n=f.$AG;function i(a){return Object.prototype.toString.call(a)=="[object Function]"}function o(a){return Object.prototype.toString.call(a)=="[object Array]"}function p(a){for(var b=0;b<a.length;){if(o(a[b])){a.splice.apply(a,[b,1].concat(a[b]));continue}b++}return a}function j(){var g;g=function(){var e,d=[],c=[];function k(){if(d!==true){for(var a=0;a<d.length;a++){if(d[a]!==true)return false}d=true}return(d===true)}function l(){var a;if(c!==true&&c.length){while(a=c.shift())a();c=true}}e={and:function(){if(c===true||c.length>0){throw new Error("Can't call `and()` anymore.");}var m=p([].slice.call(arguments)),h;for(h=0;h<m.length;h++){(function(a,b){if(!i(a))throw new Error("Wrong: non-function parameter passed in.");d[b]=false;a(function(){d[b]=true;if(k())l()})})(m[h],d.length)}return e},add:function(){if(c===true||c.length>0){throw new Error("Can't call `add()` anymore.");}var b;e.and(function(a){b=a});return b},then:function(a){if(!i(a))throw new Error("Wrong: non-function parameter passed in.");if(c!==true){c.push(a);if(k())l()}else a();return e}};e.and.apply({},arguments);return e};g.noConflict=function(){var a=f.$AG;f.$AG=n;return a};g.sandbox=function(){return j()};return g}f.$AG=j()})(this);